<html>
<head>
</head>
<title>livecamera</title>
<body>
<img id="liveImg" src="" width="480" height="360"><br>
Frames per second : <input type="text" id="fps" value="" /><br>
Video length : <input type="text" id="len" value="" /><br>
<input type="button" value="start recording" onclick="startTimeLapse()" /><br>
<p id="duration">
<script type="text/javascript">
var img = document.getElementById("liveImg");
var arrayBuffer;

var ws = new WebSocket("ws://localhost:8080/camera");
ws.binaryType = 'blob';
ws.onopen = function(){
	console.log("connection was established");
};

ws.onmessage = function(evt){
img.src = URL.createObjectURL(evt.data);
};

window.onbeforeunload = function(){
    ws.close(1000); //Is this needed??
};

function startTimeLapse() {
    fps = document.getElementById("fps").value;
    length = document.getElementById("len").value;
    ws.send('["fps", %s]'.replace("%s", fps));
    ws.send('["length", %s]'.replace("%s", length));
    fps = parseFloat(fps);
    length = parseFloat(length);
    writeInfo(fps, length*25);
}

function writeInfo(FPS, LENGTH){
//    document.write(LENGTH/FPS)
    var duration = document.getElementById("duration");
    var textnode = document.createTextNode(String(LENGTH/FPS)+" seconds");
    duration.appendChild(textnode);
}
</script>
</body>
</html>
